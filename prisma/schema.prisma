generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Document {
  id           String   @id @default(uuid())
  filename     String
  size         Int
  blobName     String
  parseMethod  String
  pageCount    Int
  chunkCount   Int
  status       String   @default("uploaded") // uploaded, processing, indexed, failed
  jobId        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  chunks       Chunk[]
  
  @@map("documents")
}

model Chunk {
  id           String   @id @default(uuid())
  documentId   String
  chunkIndex   Int
  text         String
  pageNumber   Int?
  // Note: For vector search with pgvector, enable the extension:
  // CREATE EXTENSION IF NOT EXISTS vector;
  // Then add: embedding    Unsupported("vector(3072)")?
  
  document     Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  
  @@map("chunks")
  @@index([documentId])
}
